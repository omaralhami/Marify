<!DOCTYPE html>
<html>
<head>
    <title>Marify Key Check</title>
    <script>
        // Get the key and SID from URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        const key = urlParams.get('key');
        const sid = urlParams.get('sid');

        // Load used keys from keys.json
        fetch('../keys.json')
            .then(response => response.json())
            .then(data => {
                let result = {
                    valid: false,
                    message: "Invalid key"
                };

                if (key && sid) {
                    if (data.used_keys.hasOwnProperty(key)) {
                        if (data.used_keys[key] === null) {
                            // Key exists and is not bound
                            result = {
                                valid: true,
                                message: "Key is valid and ready to bind"
                            };
                        }
                        else if (data.used_keys[key] === sid) {
                            // Key is already bound to this PC
                            result = {
                                valid: true,
                                message: "Key valid and matches this PC"
                            };
                        }
                        else {
                            // Key is bound to a different PC
                            result = {
                                valid: false,
                                message: "Key is already used on another PC"
                            };
                        }
                    }
                }

                // Return result as JSON
                document.write(JSON.stringify(result));
            })
            .catch(error => {
                document.write(JSON.stringify({
                    valid: false,
                    message: "Error checking key: " + error.message
                }));
            });
    </script>
</head>
<body>
    <!-- Response will be written here by JavaScript -->
</body>
</html> 